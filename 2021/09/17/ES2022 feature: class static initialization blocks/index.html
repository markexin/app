<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="不忘初心，努力前行"><title>ES2022 feature class static initialization blocks | Markexin</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 6.0.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">ES2022 feature class static initialization blocks</h1><a id="logo" href="/.">Markexin</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> 技术拓扑</i></a><a href="/book/"><i class="fa fa-rss"> 读书总结</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">ES2022 feature class static initialization blocks</h1><div class="post-meta">2021-09-17</div><div class="post-content"><h2 id="ES2022-feature-class-static-initialization-blocks"><a href="#ES2022-feature-class-static-initialization-blocks" class="headerlink" title="ES2022 feature: class static initialization blocks"></a>ES2022 feature: class static initialization blocks</h2><h3 id="Introduction-简介"><a href="#Introduction-简介" class="headerlink" title="Introduction 简介"></a>Introduction 简介</h3><p>Ron Buckton 在 <em>ECMAScript</em> 规范中提出  <a target="_blank" rel="noopener" href="https://github.com/tc39/proposal-class-static-block">“Class static initialization blocks” </a>已经进入到第四阶段，预计将写入2022年ECMAScript中。</p>
<p>当我们创建Class类，通常我们可以有两种方式创建 constructs：</p>
<ul>
<li> Field: 创建（并可选择初始化）实例属性；</li>
<li>构造函数Constructor：在设置完成之前执行的代码块。</li>
</ul>
<p>为了设置类的静态部分，我们只有静态字段。 ECMAScript 提案为类引入了<strong>static initialization blocks</strong> 。</p>
<p>大致上，对于静态类来说，构造函数对于实例来说是一样的。</p>
<h3 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h3><ul>
<li>为什么我们需要<strong>static blocks</strong>在class类中？</li>
<li>一个更复杂的例子</li>
<li>支持类静态块的引擎</li>
<li>JavaScript 是否变得很像 Java 和/或一团糟？</li>
<li>结论</li>
</ul>
<h4 id="1-为什么我们需要static-blocks在class类中？"><a href="#1-为什么我们需要static-blocks在class类中？" class="headerlink" title="1. 为什么我们需要static blocks在class类中？"></a>1. 为什么我们需要<strong>static blocks</strong>在class类中？</h4><p>为了方便外部函数调用内部属性，我们通常会这样设置：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Translator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> translations = &#123;</span><br><span class="line">    <span class="attr">yes</span>: <span class="string">&#x27;ja&#x27;</span>,</span><br><span class="line">    <span class="attr">no</span>: <span class="string">&#x27;nein&#x27;</span>,</span><br><span class="line">    <span class="attr">maybe</span>: <span class="string">&#x27;vielleicht&#x27;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">static</span> englishWords = extractEnglish(<span class="built_in">this</span>.translations);</span><br><span class="line">  <span class="keyword">static</span> germanWords = extractGerman(<span class="built_in">this</span>.translations);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">extractEnglish</span>(<span class="params">translations</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Object</span>.keys(translations);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">extractGerman</span>(<span class="params">translations</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Object</span>.values(translations);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这种情况下，使用外部函数 extractEnglish() 和 extractGerman() 效果很好，因为我们可以看到它们是从<strong>类内部调用的</strong>，并且它们完全<strong>独立于类</strong>。但是，如果我们想同时设置两个静态字段，事情就会变得不那么优雅：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Translator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> translations = &#123;</span><br><span class="line">    <span class="attr">yes</span>: <span class="string">&#x27;ja&#x27;</span>,</span><br><span class="line">    <span class="attr">no</span>: <span class="string">&#x27;nein&#x27;</span>,</span><br><span class="line">    <span class="attr">maybe</span>: <span class="string">&#x27;vielleicht&#x27;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">static</span> englishWords = [];</span><br><span class="line">  <span class="keyword">static</span> germanWords = [];</span><br><span class="line">  <span class="keyword">static</span> _ = initializeTranslator( <span class="comment">// (A)</span></span><br><span class="line">    <span class="built_in">this</span>.translations, <span class="built_in">this</span>.englishWords, <span class="built_in">this</span>.germanWords);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initializeTranslator</span>(<span class="params">translations, englishWords, germanWords</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> [english, german] <span class="keyword">of</span> <span class="built_in">Object</span>.entries(translations)) &#123;</span><br><span class="line">    englishWords.push(english);</span><br><span class="line">    germanWords.push(german);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这次有几个问题：</p>
<ul>
<li>调用 initializeTranslator() 是一个额外的步骤，必须在创建类之后在类之外执行。或者通过变通方法执行（A 行）。</li>
<li>initializeTranslator() 无权访问 Translator 的私有属性。</li>
</ul>
<p>当我们使用 <strong>static initialization blocks</strong>（A 行），我们有一个更优雅的解决方案。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Translator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> translations = &#123;</span><br><span class="line">    <span class="attr">yes</span>: <span class="string">&#x27;ja&#x27;</span>,</span><br><span class="line">    <span class="attr">no</span>: <span class="string">&#x27;nein&#x27;</span>,</span><br><span class="line">    <span class="attr">maybe</span>: <span class="string">&#x27;vielleicht&#x27;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">static</span> englishWords = [];</span><br><span class="line">  <span class="keyword">static</span> germanWords = [];</span><br><span class="line">  <span class="keyword">static</span> &#123; <span class="comment">// (A)</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> [english, german] <span class="keyword">of</span> <span class="built_in">Object</span>.entries(<span class="built_in">this</span>.translations)) &#123;</span><br><span class="line">      <span class="built_in">this</span>.englishWords.push(english);</span><br><span class="line">      <span class="built_in">this</span>.germanWords.push(german);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="2-一个更复杂的例子"><a href="#2-一个更复杂的例子" class="headerlink" title="2.一个更复杂的例子"></a>2.一个更复杂的例子</h4><p><strong>static initialization blocks</strong> 的细节是相对合乎逻辑的（相对于更复杂的实例成员规则）：</p>
<ul>
<li>每个类可以有多个静态块。</li>
<li>静态块的执行与静态字段初始值设定项的执行交错执行。</li>
<li>超类的静态成员在子类的静态成员之前执行。</li>
</ul>
<p>以下代码演示了这些规则：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SuperClass</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> superField1 = <span class="built_in">console</span>.log(<span class="string">&#x27;superField1&#x27;</span>);</span><br><span class="line">  <span class="keyword">static</span> &#123;</span><br><span class="line">    assert.equal(<span class="built_in">this</span>, SuperClass);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;static block 1 SuperClass&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> superField2 = <span class="built_in">console</span>.log(<span class="string">&#x27;superField2&#x27;</span>);</span><br><span class="line">  <span class="keyword">static</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;static block 2 SuperClass&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubClass</span> <span class="keyword">extends</span> <span class="title">SuperClass</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> subField1 = <span class="built_in">console</span>.log(<span class="string">&#x27;subField1&#x27;</span>);</span><br><span class="line">  <span class="keyword">static</span> &#123;</span><br><span class="line">    assert.equal(<span class="built_in">this</span>, SubClass);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;static block 1 SubClass&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> subField2 = <span class="built_in">console</span>.log(<span class="string">&#x27;subField2&#x27;</span>);</span><br><span class="line">  <span class="keyword">static</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;static block 2 SubClass&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line"><span class="comment">// &#x27;superField1&#x27;</span></span><br><span class="line"><span class="comment">// &#x27;static block 1 SuperClass&#x27;</span></span><br><span class="line"><span class="comment">// &#x27;superField2&#x27;</span></span><br><span class="line"><span class="comment">// &#x27;static block 2 SuperClass&#x27;</span></span><br><span class="line"><span class="comment">// &#x27;subField1&#x27;</span></span><br><span class="line"><span class="comment">// &#x27;static block 1 SubClass&#x27;</span></span><br><span class="line"><span class="comment">// &#x27;subField2&#x27;</span></span><br><span class="line"><span class="comment">// &#x27;static block 2 SubClass&#x27;</span></span><br></pre></td></tr></table></figure>



<h4 id="3-支持类静态块的引擎"><a href="#3-支持类静态块的引擎" class="headerlink" title="3. 支持类静态块的引擎"></a>3. 支持类静态块的引擎</h4><ul>
<li>V8: unflagged in v9.4.146 (<a target="_blank" rel="noopener" href="https://github.com/tc39/proposal-class-static-block#stage-4-entrance-criteria">source</a>)</li>
<li>SpiderMonkey: behind a flag in v92, intent to ship unflagged in v93 (<a target="_blank" rel="noopener" href="https://github.com/tc39/proposal-class-static-block#stage-4-entrance-criteria">source</a>)</li>
<li>TypeScript: v4.4 (<a target="_blank" rel="noopener" href="https://devblogs.microsoft.com/typescript/announcing-typescript-4-4-rc/">source</a>)</li>
</ul>
<h4 id="4-JavaScript-是否变得很像-Java-和-或一团糟？"><a href="#4-JavaScript-是否变得很像-Java-和-或一团糟？" class="headerlink" title="4. JavaScript 是否变得很像 Java 和/或一团糟？"></a>4. JavaScript 是否变得很像 Java 和/或一团糟？</h4><p>这是一个小功能，不会与其他功能竞争。我们已经可以通过带有 <code>static _ = ...</code> 解决方法的运行。<strong>static initialization blocks</strong> 意味着不再需要这种解决方法。除此之外，类只是JavaScript程序员的众多工具之一。有些人使用它，有些人不使用，还有很多替代方法。即使是使用类的JavaScript代码也经常使用函数，并且趋向于轻量级。</p>
<h4 id="5-结论"><a href="#5-结论" class="headerlink" title="5.结论"></a>5.结论</h4><p><strong>static initialization blocks</strong> 是一个相对简单的特性，它完善了类的静态属性。粗略地说，它是实例构造函数的静态版本。当我们必须设置多个静态字段时，它可以发挥很大的作用。</p>
</div><div class="tags"><a href="/tags/%E8%B6%A3%E5%91%B3%E6%9D%82%E8%B0%88/"><i class="fa fa-tag"></i>趣味杂谈</a></div><div class="post-nav"><a class="pre" href="/2021/12/09/Nuxt3/">Nuxt 3 概述</a><a class="next" href="/2021/09/08/JAVA%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">JAVA 数据结构</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://example.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/vue/" style="font-size: 15px;">vue</a> <a href="/tags/%E8%B6%A3%E5%91%B3%E6%9D%82%E8%B0%88/" style="font-size: 15px;">趣味杂谈</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/node/" style="font-size: 15px;">node</a> <a href="/tags/react/" style="font-size: 15px;">react</a> <a href="/tags/js/" style="font-size: 15px;">js</a> <a href="/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/" style="font-size: 15px;">浏览器</a> <a href="/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" style="font-size: 15px;">性能优化</a> <a href="/tags/css/" style="font-size: 15px;">css</a> <a href="/tags/%E8%BF%90%E7%BB%B4/" style="font-size: 15px;">运维</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 15px;">算法</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2022/04/27/%E5%A6%82%E4%BD%95%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AAd.ts%E6%96%87%E4%BB%B6/">如何编写一个d.ts文件</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/04/02/%E5%85%B3%E4%BA%8E%E6%99%8B%E5%8D%87/">关于晋升</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/16/%E5%89%8D%E7%AB%AF%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/">请别在拿对称非对称加密来说事了</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/02/22/%E5%9B%9E%E6%BA%AF%E7%AE%97%E6%B3%95/">回溯算法</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/02/21/%E7%AE%97%E6%B3%95%E5%9F%BA%E7%A1%80%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">算法基础数据结构</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/01/07/JS%20%20%E7%B2%BE%E5%BA%A6%E9%97%AE%E9%A2%98/">JS 精度问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/01/07/ddos/">DDOS 攻击与防范</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/01/04/react%E4%B8%AD%E7%9A%84this/">重识 react this</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/12/29/babel%E5%85%A5%E9%97%A8/">babel 插件</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/12/28/js-sandbox%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/">JS Sandbox 实现原理</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="https://github.com/jiajianrong/documents" title="jiajianrong" target="_blank">jiajianrong</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2022 <a href="/." rel="nofollow">Markexin.     </a><span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv">次</span></span></div></div></div><script type="text/javascript" src="/js/kity.min.js"></script><script type="text/javascript" src="/js/kityminder.core.min.js"></script><script type="text/javascript" src="/js/mindmap.min.js"></script><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script><script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>